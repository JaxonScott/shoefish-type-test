import { type NextPage } from "next";
import Head from "next/head";
import { ChangeEvent, useState, useEffect } from "react";

const Home: NextPage = () => {
  const [correct, setCorrect] = useState(true);
  const [index, setIndex] = useState(0);
  const [pressedKeys, setPressedKeys] = useState([]);
  const testText = "the fox that jumped over the fence";

  useEffect(() => {
    const detectKeyDown = (e) => {
      console.log("Clicked key: ", e.key);
      if (e.key === testText[index] && e.key !== "Backspace") {
        setIndex(index + 1);
        setCorrect(correct);
        setPressedKeys([...pressedKeys, e.key]);
      } else if (e.key === "Backspace" && index >= 0) {
        setPressedKeys(pressedKeys.slice(0, -1));
        setIndex(index - 1);
      } else {
        setPressedKeys([...pressedKeys, e.key]);
        setCorrect(false);
      }
    };

    document.addEventListener("keydown", detectKeyDown, true);
  }, [index]);

  return (
    <>
      <Head>
        <title>Shoefish</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className="flex h-screen w-full flex-col items-center justify-center">
        <h1>{correct ? "Correct" : "not correct"}</h1>
        <h1>{testText}</h1>
        <div>
          <p>{pressedKeys.join("")}</p>
        </div>
      </main>
    </>
  );
};

export default Home;
